pipeline {
    agent any
   stages {
        stage('Checking database container') {
            steps {
                script {
                    def containerExists = sh(script: 'docker inspect -f {{.State.Running}} mysql', returnStatus: true)
                    if (containerExists == 0) {
                        echo 'MySQL container already exists'
                    } else {
                        sh 'docker container run -d --name mysql --network lmsnetwork -e MYSQL_ROOT_PASSWORD=Password@123 -p 3307:3306 mysql:latest'
                    }
                }
            }
        }
        
        stage('Previous container') {
            steps {
                script {
                    def containerRunning = sh(script: 'docker inspect -f {{.State.Running}} be', returnStatus: true)
                    if (containerRunning == 0) {
                        sh 'docker container stop be' 
                        sh 'docker container rm be' 
                    }
                    else {
                        sh 'echo container not existing'
                    }
                }
            }
        }        
        stage('Docker Build') {
            steps {
                sh 'cd LMS-BE && docker build -t backend .'
            }
        }        
        stage('Docker container') {
            steps {
                sh 'docker container run -dt --name be --network lmsnetwork -p 8181:8080 backend'
            }
        }
    }
}
